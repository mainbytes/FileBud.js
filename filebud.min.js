class FileBud{constructor(){}conf={memoryRevokeTimeout:3e3,prefix:"[FileBud]"};fileWrapper(e){if(e)return{file:e,name:e.name,type:e.type,download:t=>{const r=URL.createObjectURL(e),i=document.createElement("a");i.download=t||e.name,i.href=r,i.click(),setTimeout((()=>{URL.revokeObjectURL(r)}),this.conf.memoryRevokeTimeout)},isType:t=>{if(!t)return!1;const r=t=>{t=t.toLowerCase();const r=e.name.toLowerCase(),i=e.type.toLowerCase();if(/^[a-z0-9]+$|^\.[a-z0-9]+$/.test(t))return r.endsWith(t.startsWith(".")?t:"."+t)||i===t;try{const e=new RegExp(t,"i");return e.test(r)||e.test(i)}catch(e){return console.warn("[FileBud] Invalid regex:",t),!1}};return Array.isArray(t)?t.some(r):r(t)},read:(t="text",r=1048576)=>new Promise((async(i,n)=>{if(!e)return n(new Error("[FileBud] No file loaded"));let o=[];const a=e=>new Promise(((r,i)=>{const n=new FileReader;n.onerror=i,n.onload=()=>r(n.result),"text"===t||"json"===t?n.readAsText(e):"arrayBuffer"===t||"binaryString"===t?n.readAsArrayBuffer(e):"dataURL"===t?n.readAsDataURL(e):i(new Error(`[FileBud] Unsupported read type: ${t}`))}));try{const l=e.size;for(let i=0;i<l;i+=r){const n=e.slice(i,i+r);let l=await a(n);if("binaryString"===t&&l instanceof ArrayBuffer){const e=new Uint8Array(l),t=32768;let r="";for(let i=0;i<e.length;i+=t){const n=e.subarray(i,i+t);r+=String.fromCharCode.apply(null,n)}l=r}o.push(l),await new Promise((e=>setTimeout(e,0)))}let s=o.join("");if("json"===t)try{s=JSON.parse(s)}catch{return n(new Error("[FileBud] Invalid JSON content"))}i(s)}catch(e){n(e)}})),size:e.size,sizeAs:t=>{let r={B:1,KiB:1024,MiB:Math.pow(1024,2),GiB:Math.pow(1024,3),TiB:Math.pow(1024,4),PiB:Math.pow(1024,5),KB:1e3,MB:Math.pow(1e3,2),GB:Math.pow(1e3,3),TB:Math.pow(1e3,4),PB:Math.pow(1e3,5)};return e.size/r[t||"B"]},displaySize:(t=2,r=!0,i)=>{const n=e.size;let o=r?["B","KiB","MiB","GiB","TiB","PiB"]:["B","KB","MB","GB","TB","PB"],a=r?1024:1e3,l=0;return i?(l=o.indexOf(i),-1===l&&(l=0)):(l=0===n?0:Math.floor(Math.log(n)/Math.log(a)),l=Math.min(l,o.length-1)),`${(n/Math.pow(a,l)).toFixed(t)} ${o[l]}`}};console.error("[FileBud] Valid file blob is invalid or empty")}getFileInput(e){return new Promise(((t,r)=>{const i=document.querySelector(e);i&&i.files&&i.files[0]||r(this.conf.prefix+" The file is unavailable"),i.files.length>1&&r(this.conf.prefix+" The file uploaded is more than one, use getFilesInput for handling this"),t(this.fileWrapper(i.files[0]))}))}getFilesInput(e){return new Promise(((t,r)=>{const i=document.querySelector(e);i&&i.files&&i.files[0]||r(this.conf.prefix+" The file is unavailable"),t(Array.from(i.files).map((e=>this.fileWrapper(e))))}))}downloadString(e,t="file.txt",r="text/plain"){const i=new Blob([e],{type:r}),n=new File([i],t,{type:r});return this.fileWrapper(n).download()}downloadJSON(e,t="file.json"){const r=JSON.stringify(e,null,2),i=new Blob([r],{type:"application/json"}),n=new File([i],t,{type:"application/json"});return this.fileWrapper(n).download()}async getFileInputFromURL(e,t="file"){try{const r=await fetch(e),i=await r.blob(),n=new File([i],t,{type:i.type});return this.fileWrapper(n)}catch(e){return console.error(this.conf.prefix+" Failed to fetch file from URL:",e),null}}async getFilesInputFromURL(e){try{return(await Promise.all(e.map((async(e,t)=>{const r=await fetch(e),i=await r.blob(),n=e.split("?")[0].split("#")[0].split("/"),o=n[n.length-1]||n[n.length-2]||`file${t+1}`;return new File([i],o,{type:i.type})})))).map((e=>this.fileWrapper(e)))}catch(e){return console.error(this.conf.prefix+" Failed to fetch files from URLs:",e),[]}}}